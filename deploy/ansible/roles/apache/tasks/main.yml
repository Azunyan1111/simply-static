---
- name: install apache
  apt: name={{ item }} state=present
  with_items:
    - apache2
    - libapache2-mod-php5

- name: configure ports.conf for apache sites
  template: src=ports.conf.j2 dest={{ apache_conf_dir }}/ports.conf

- name: install snakeoil crt
  copy:
    src: snakeoil.crt
    dest: /etc/ssl/certs/snakeoil.crt

- name: install snakeoil key
  copy:
    src: snakeoil.key
    dest: /etc/ssl/private/snakeoil.key

- command: a2enmod rewrite

- command: a2enmod headers

- command: a2enmod ssl

- command: a2enmod php5

- name: disable default site
  file: path=/etc/apache2/sites-enabled/000-default state=absent

- name: configure wordpress apache sites
  template: src=wordpress.conf.j2 dest={{ apache_conf_dir }}/sites-enabled/{{ item.host }}.conf
  with_items: '{{ wordpress_sites }}'

- name: restart apache
  service: 'name=apache2 state=restarted'
